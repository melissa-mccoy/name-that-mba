<h1>Name That MBA</h1>
<img id="photo" />
<h2>Who is pictured above?</h2>
<button id="0" class="btn btn-primary block m-b ans"></button>
<button id="1" class="btn btn-primary block m-b ans"></button>
<button id="2" class="btn btn-primary block m-b ans"></button>
<button id="3" class="btn btn-primary block m-b ans"></button>
<div id="responseMessage"></div>
<button class="btn btn-primary block m-b" id="next">Next</button>

<script src="//connect.facebook.net/en_US/all.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  // //Setup FB SDK
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '150302955316986',
      xfbml      : true,
      version    : 'v2.4'
    });

  //Initialize Game

  Student = function(name,facebookID) {
    this.name = name
    this.facebookID = facebookID
  }

  Student.prototype = {

  }
  //Student Model Class

  //Build View with 4 students, Choose chosen student, & Retrieve their image
  $.ajax({
    method: "GET",
    url: "/students",
    dataType: "json"
  }).done(function(studentsJsonArray) {
      console.log("Response successful")
      console.log(studentsJsonArray)
      startGame(studentsJsonArray);
      $("#next").click(function(e){
        $("#responseMessage").html("")
        startGame(studentsJsonArray)
      });
  });

  function startGame(students) {
    console.log(students)
    // //Game Controller
    var randomIndexes = getRandomInts(students.length,4);
    $('#0').html(students[randomIndexes[0]].name);
    $('#1').html(students[randomIndexes[1]].name);
    $('#2').html(students[randomIndexes[2]].name);
    $('#3').html(students[randomIndexes[3]].name);
    var chosenAnswerIndex = Math.floor(Math.random()*randomIndexes.length);
    var chosenStudent = students[randomIndexes[chosenAnswerIndex]];
    console.log("ChosenAnswerId "+ chosenAnswerIndex)
    console.log(chosenStudent)
    //Database Way
    $('#photo').attr("src","https://"+chosenStudent.photo_url);

    //FBAPI Way
    // FB.api('/'+chosenStudent.facebook_id+'/picture', 'GET', {}, function(response) {
    //   console.log("inside repsonse")
    //   console.log(response)
    //   $('#photo').attr("src",response.data.url);
    // })
    //Add Listeners to Answer Choices & specify if correct/incorrect when clicked
    $(".ans").click(function(e){
        var clickedId = e.target.id;
        console.log(clickedId == chosenAnswerIndex.toString())
        if(clickedId == chosenAnswerIndex.toString()) {
          $("#responseMessage").html('<div class="alert alert-success alert-dismissable"><button aria-hidden="true" data-dismiss="alert" class="close" type="button">× Correct</button></div>')
        } else {
          $("#responseMessage").html('<div id="incorrect" class="alert alert-danger alert-dismissable"><button aria-hidden="true" data-dismiss="alert" class="close" type="button">× Incorrect</button></div>')
        }
    });



  function getRandomInts(max,count) {
    var chosenNums = [];
    while(chosenNums.length < count){
      var num=Math.floor(Math.random()*max); var alreadyChosen=false;
      for(var i=0;i<chosenNums.length;i++) {
        if(chosenNums[i]==num){alreadyChosen=true;break}
      }
      if(!alreadyChosen)chosenNums[chosenNums.length]=num;
    }
    return chosenNums
  }
};
};
});
</script>
